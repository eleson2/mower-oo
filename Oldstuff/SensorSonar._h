#ifndef _SENSORSONAR_
#define _SENSORSONAR_

#define _TASK_OO_CALLBACKS

#include <TaskSchedulerDeclarations.h>
#include <Arduino.h>
#include <YetAnotherPcInt.h> 

class sSonar: public Task  { 
private:
    uint8_t TriggerPin;
    uint8_t ResponsePin;
    
	volatile unsigned long _responseStartMicros;

    unsigned int SonarDistance;
    unsigned int lastSonarDistance=0;
    static constexpr int  _soundSpeedFactor =2560000 / (3310 + 6 * 22);

public:
    sSonar(Scheduler* aS, unsigned int timeOut, 
           uint8_t   trigger_pin, uint8_t _response_pin) ;
    ~sSonar();
    
    bool Callback() override;

    bool OnEnable() override;
    void OnDisable() override;

	void Measure();
	void Stop();

    static void responseStart(sSonar *);
    static void responseEnd(sSonar *);
    
    void SonarTimeoutCallback();

    unsigned int GetMeasure();
    unsigned int GetLastMeasure();
    unsigned int GetLastMeasureMM();
    
    // void SetTemperatureCorrection(int8_t tempCelsius);
};
#endif